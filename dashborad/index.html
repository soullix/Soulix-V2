<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soulix Tech - Admin Portal</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Scroll Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>
    
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Animated Background -->
    <div class="animated-background">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
        <div class="particle-container">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
    </div>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <!-- Close button for mobile -->
        <button class="sidebar-close" id="sidebarClose">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-layer-group"></i>
                <div class="logo-glow"></div>
            </div>
            <div class="logo-text">
                <h2>SOULIX TECH</h2>
                <p>Administration Portal</p>
            </div>
        </div>
        
        <nav class="nav-menu">
            <div class="nav-section-title">MAIN MENU</div>
            <a href="#" class="nav-item active" data-section="overview">
                <div class="nav-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <span>Dashboard</span>
                <div class="nav-indicator"></div>
            </a>
            <a href="#" class="nav-item" data-section="applications">
                <div class="nav-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <span>Applications</span>
                <div class="nav-badge" id="pendingBadge">0</div>
                <div class="nav-indicator"></div>
            </a>
            <a href="#" class="nav-item" data-section="approved">
                <div class="nav-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <span>Approved</span>
                <div class="nav-indicator"></div>
            </a>
            <a href="#" class="nav-item" data-section="rejected">
                <div class="nav-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <span>Rejected</span>
                <div class="nav-indicator"></div>
            </a>
            
            <div class="nav-section-title" style="margin-top: 2rem;">INSIGHTS</div>
            <a href="#" class="nav-item" data-section="analytics">
                <div class="nav-icon">
                    <i class="fas fa-chart-pie"></i>
                </div>
                <span>Analytics</span>
                <div class="nav-indicator"></div>
            </a>
            <a href="#" class="nav-item" data-section="courses">
                <div class="nav-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <span>Courses</span>
                <div class="nav-indicator"></div>
            </a>
            <a href="#" class="nav-item" data-section="payments">
                <div class="nav-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <span>Payment History</span>
                <div class="nav-indicator"></div>
            </a>
            <a href="#" class="nav-item" data-section="logs">
                <div class="nav-icon">
                    <i class="fas fa-history"></i>
                </div>
                <span>Admin Log</span>
                <div class="nav-badge" id="logBadge" style="display: none;">0</div>
                <div class="nav-indicator"></div>
            </a>
        </nav>

        <div class="admin-profile">
            <div class="admin-avatar">
                <i class="fas fa-user-shield"></i>
                <div class="status-dot"></div>
            </div>
            <div class="admin-info">
                <div class="admin-name" id="adminUsername">Admin</div>
                <div class="admin-role">Super Admin</div>
            </div>
            <button class="logout-btn" id="logoutBtn" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 id="page-title">Dashboard Overview</h1>
                <p id="page-subtitle">
                    <span class="live-indicator">
                        <span>LIVE</span>
                    </span>
                    <i class="fas fa-clock"></i>
                    <span id="currentDateTime"></span>
                </p>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search applications...">
                </div>
                <button class="notification-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">0</span>
                </button>
            </div>
        </header>

        <!-- Overview Section -->
        <section id="overview-section" class="content-section active">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card card-blue">
                    <div class="stat-icon-wrap">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalPending">0</h3>
                        <p>Pending Applications</p>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>12% from last week</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card card-green">
                    <div class="stat-icon-wrap">
                        <div class="stat-icon">
                            <i class="fas fa-check-double"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalApproved">0</h3>
                        <p>Approved Students</p>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>8% from last week</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card card-red">
                    <div class="stat-icon-wrap">
                        <div class="stat-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalRejected">0</h3>
                        <p>Rejected Applications</p>
                        <div class="stat-trend down">
                            <i class="fas fa-arrow-down"></i>
                            <span>5% from last week</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card card-purple">
                    <div class="stat-icon-wrap">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalApplications">0</h3>
                        <p>Total Applications</p>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>15% from last week</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="dashboard-grid">
                <div class="glass-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Application Trends</h3>
                        <select class="filter-select">
                            <option>Last 7 Days</option>
                            <option>Last 30 Days</option>
                            <option>Last 3 Months</option>
                        </select>
                    </div>
                    <canvas id="applicationTrendChart"></canvas>
                </div>

                <div class="glass-card">
                    <div class="card-header">
                        <h3><i class="fas fa-graduation-cap"></i> Course Distribution</h3>
                    </div>
                    <canvas id="courseDistributionChart"></canvas>
                </div>
            </div>

            <!-- Recent Applications -->
            <div class="glass-card">
                <div class="card-header">
                    <h3><i class="fas fa-history"></i> Recent Applications</h3>
                    <a href="#" class="view-all-link" data-section="applications">View All <i class="fas fa-arrow-right"></i></a>
                </div>
                <div id="recentApplicationsList"></div>
            </div>
        </section>

        <!-- Applications Section -->
        <section id="applications-section" class="content-section">
            <div class="section-header">
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">All <span class="tab-count" id="allCount">0</span></button>
                    <button class="filter-tab" data-filter="pending">Pending <span class="tab-count" id="pendingCount">0</span></button>
                    <button class="filter-tab" data-filter="today">Today <span class="tab-count" id="todayCount">0</span></button>
                </div>
                <div class="section-actions">
                    <div class="search-box-inline">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchApplications" placeholder="Search by name, email, phone...">
                    </div>
                    <select id="filterCourseApp" class="filter-select">
                        <option value="">All Courses</option>
                        <option value="Web Development">Web Development</option>
                        <option value="IoT & ESP32">IoT & ESP32</option>
                        <option value="C Programming">C Programming</option>
                        <option value="Python Programming">Python Programming</option>
                    </select>
                </div>
            </div>

            <div class="applications-grid" id="applicationsGrid"></div>
        </section>

        <!-- Approved Section -->
        <section id="approved-section" class="content-section">
            <div class="section-header">
                <div class="section-title-group">
                    <h2><i class="fas fa-check-circle"></i> Approved Students</h2>
                    <p>Students who have been approved for enrollment</p>
                </div>
                <div class="section-actions">
                    <div class="search-box-inline">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchApproved" placeholder="Search approved students...">
                    </div>
                    <button class="export-btn">
                        <i class="fas fa-download"></i> Export List
                    </button>
                </div>
            </div>
            <div class="applications-grid" id="approvedGrid"></div>
        </section>

        <!-- Rejected Section -->
        <section id="rejected-section" class="content-section">
            <div class="section-header">
                <div class="section-title-group">
                    <h2><i class="fas fa-times-circle"></i> Rejected Applications</h2>
                    <p>Applications that were not approved</p>
                </div>
                <div class="section-actions">
                    <div class="search-box-inline">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchRejected" placeholder="Search rejected applications...">
                    </div>
                </div>
            </div>
            <div class="applications-grid" id="rejectedGrid"></div>
        </section>

        <!-- Courses Section -->
        <section id="courses-section" class="content-section">
            <div class="courses-grid-modern">
                <div class="course-card-modern card-gradient-1">
                    <div class="course-icon-modern">
                        <i class="fas fa-code"></i>
                    </div>
                    <h3>Web Development</h3>
                    <p class="course-duration"><i class="fas fa-clock"></i> 4 Weeks â€¢ Weekend</p>
                    <div class="course-price">â‚¹199</div>
                    <div class="course-stats-modern">
                        <div class="stat-item">
                            <span class="stat-value" data-course="Web Development" data-status="Approved">0</span>
                            <span class="stat-label">Enrolled</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value pending-count" data-course="Web Development">0</span>
                            <span class="stat-label">Pending</span>
                        </div>
                    </div>
                    <div class="course-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" data-course="Web Development" style="width: 0%"></div>
                        </div>
                        <span class="progress-text">0% Capacity</span>
                    </div>
                </div>

                <div class="course-card-modern card-gradient-2">
                    <div class="course-icon-modern">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <h3>IoT & ESP32</h3>
                    <p class="course-duration"><i class="fas fa-clock"></i> 3 Weeks â€¢ Weekend</p>
                    <div class="course-price">â‚¹295</div>
                    <div class="course-stats-modern">
                        <div class="stat-item">
                            <span class="stat-value" data-course="IoT & ESP32" data-status="Approved">0</span>
                            <span class="stat-label">Enrolled</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value pending-count" data-course="IoT & ESP32">0</span>
                            <span class="stat-label">Pending</span>
                        </div>
                    </div>
                    <div class="course-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" data-course="IoT & ESP32" style="width: 0%"></div>
                        </div>
                        <span class="progress-text">0% Capacity</span>
                    </div>
                </div>

                <div class="course-card-modern card-gradient-3">
                    <div class="course-icon-modern">
                        <i class="fas fa-terminal"></i>
                    </div>
                    <h3>C Programming</h3>
                    <p class="course-duration"><i class="fas fa-clock"></i> 3 Weeks â€¢ Weekend</p>
                    <div class="course-price">â‚¹199</div>
                    <div class="course-stats-modern">
                        <div class="stat-item">
                            <span class="stat-value" data-course="C Programming" data-status="Approved">0</span>
                            <span class="stat-label">Enrolled</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value pending-count" data-course="C Programming">0</span>
                            <span class="stat-label">Pending</span>
                        </div>
                    </div>
                    <div class="course-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" data-course="C Programming" style="width: 0%"></div>
                        </div>
                        <span class="progress-text">0% Capacity</span>
                    </div>
                </div>

                <div class="course-card-modern card-gradient-4">
                    <div class="course-icon-modern">
                        <i class="fab fa-python"></i>
                    </div>
                    <h3>Python Programming</h3>
                    <p class="course-duration"><i class="fas fa-clock"></i> 4 Weeks â€¢ Weekend</p>
                    <div class="course-price">â‚¹299</div>
                    <div class="course-stats-modern">
                        <div class="stat-item">
                            <span class="stat-value" data-course="Python Programming" data-status="Approved">0</span>
                            <span class="stat-label">Enrolled</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value pending-count" data-course="Python Programming">0</span>
                            <span class="stat-label">Pending</span>
                        </div>
                    </div>
                    <div class="course-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" data-course="Python Programming" style="width: 0%"></div>
                        </div>
                        <span class="progress-text">0% Capacity</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Payment History Section -->
        <section id="payments-section" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-money-bill-wave"></i> Payment History</h2>
                <p>Track all payment transactions and installments</p>
            </div>
            
            <div class="payment-stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <div class="stat-icon-wrap">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalPaidPayments">0</div>
                        <div class="stat-label">Full Payments</div>
                    </div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <div class="stat-icon-wrap">
                        <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalInstallmentPayments">0</div>
                        <div class="stat-label">Installments</div>
                    </div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    <div class="stat-icon-wrap">
                        <div class="stat-icon"><i class="fas fa-rupee-sign"></i></div>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalRevenue">â‚¹0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-history"></i> Recent Payments</h3>
                    <div class="header-actions">
                        <select id="paymentStatusFilter" style="padding: 8px 12px; border-radius: 8px; border: 1px solid #e5e7eb; background: white;">
                            <option value="all">All Payments</option>
                            <option value="Paid">Full Payment</option>
                            <option value="Installment">Installment</option>
                        </select>
                    </div>
                </div>
                <div id="paymentHistoryList" class="payment-list"></div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="content-section">
            <div class="analytics-grid-modern">
                <div class="glass-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-area"></i> Application Statistics</h3>
                    </div>
                    <canvas id="applicationStatsChart"></canvas>
                </div>
                
                <div class="glass-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-pie"></i> Status Distribution</h3>
                    </div>
                    <canvas id="statusDistributionChart"></canvas>
                </div>

                <div class="glass-card full-width">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-alt"></i> Weekly Application Flow</h3>
                    </div>
                    <canvas id="weeklyFlowChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Admin Log Section -->
        <section id="logs-section" class="content-section">
            <div class="section-header">
                <div class="section-title-group">
                    <h2><i class="fas fa-history"></i> Admin Activity Log</h2>
                    <p>Real-time tracking of all admin actions and email operations</p>
                </div>
                <div class="section-actions">
                    <button class="btn-action btn-view" id="clearLogBtn">
                        <i class="fas fa-trash"></i> Clear Log
                    </button>
                    <button class="export-btn">
                        <i class="fas fa-download"></i> Export Log
                    </button>
                </div>
            </div>

            <div class="glass-card">
                <div class="log-filters" style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="filter-btn active" data-log-filter="all">
                        <i class="fas fa-list"></i> All
                    </button>
                    <button class="filter-btn" data-log-filter="success">
                        <i class="fas fa-check-circle"></i> Success
                    </button>
                    <button class="filter-btn" data-log-filter="error">
                        <i class="fas fa-times-circle"></i> Errors
                    </button>
                    <button class="filter-btn" data-log-filter="info">
                        <i class="fas fa-info-circle"></i> Info
                    </button>
                    <button class="filter-btn" data-log-filter="warning">
                        <i class="fas fa-exclamation-triangle"></i> Warnings
                    </button>
                </div>

                <div id="adminLogBody" class="admin-log-list">
                    <div class="admin-log-empty">
                        <i class="fas fa-info-circle"></i>
                        <p>Activity log will appear here</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Application Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content-large">
            <button class="modal-close" id="closeDetailModal">
                <i class="fas fa-times"></i>
            </button>
            <div id="applicationDetailContent"></div>
        </div>
    </div>

    <!-- Email Preview Modal -->
    <div id="emailPreviewModal" class="modal">
        <div class="modal-content-large">
            <button class="modal-close" id="closeEmailPreviewModal">
                <i class="fas fa-times"></i>
            </button>
            <div id="emailPreviewContent" style="background: #fff; padding: 20px; border-radius: 12px; max-height: 80vh; overflow-y: auto;">
                <h3 style="margin-bottom: 20px; color: #333;">ðŸ“§ Email Preview</h3>
                <iframe id="emailPreviewFrame" style="width: 100%; min-height: 500px; border: none; border-radius: 8px;"></iframe>
                <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
                    <button class="btn-action btn-view" onclick="document.getElementById('emailPreviewModal').classList.remove('show')">
                        <i class="fas fa-times"></i> Close
                    </button>
                    <button class="btn-action btn-approve" id="confirmSendEmail" style="display: none;">
                        <i class="fas fa-paper-plane"></i> Send Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Confirmation Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closePaymentModal()">
                <i class="fas fa-times"></i>
            </button>
            <div style="padding: 2rem;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="display: inline-flex; align-items: center; justify-content: center; width: 64px; height: 64px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 16px; margin-bottom: 1rem;">
                        <i class="fas fa-check-circle" style="font-size: 32px; color: white;"></i>
                    </div>
                    <h2 style="font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">Approve Application</h2>
                    <p style="color: var(--text-secondary); font-size: 14px;" id="paymentModalStudentName"></p>
                </div>

                <div style="background: var(--card-bg); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                    <div style="display: grid; gap: 1rem; font-size: 14px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Payment Type:</span>
                            <strong id="paymentModalType" style="color: var(--text-primary);"></strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">UPI Transaction:</span>
                            <strong id="paymentModalUPI" style="color: var(--text-primary);"></strong>
                        </div>
                        <div id="installmentInfo" style="display: none; flex-direction: column; gap: 0.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-secondary);">Installments Paid:</span>
                                <strong id="paymentModalInstallments" style="color: var(--text-primary);"></strong>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem; font-size: 14px;">
                        <i class="fas fa-rupee-sign"></i> Confirm Payment Amount Received
                    </label>
                    <input type="number" id="paymentAmountInput" placeholder="Enter amount in â‚¹" 
                           style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 16px; font-weight: 600; transition: all 0.2s;"
                           onfocus="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 0 0 3px rgba(99, 102, 241, 0.1)'"
                           onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button class="btn-action btn-view" onclick="closePaymentModal()" style="flex: 1;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn-action btn-approve" onclick="confirmPaymentApproval()" style="flex: 1;">
                        <i class="fas fa-check"></i> Confirm & Approve
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="toast-icon"></div>
        <div class="toast-content">
            <div class="toast-title"></div>
            <div class="toast-message"></div>
        </div>
        <button class="toast-close">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Chart.js (Optimized: Defer loading) -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Authentication & Core Scripts (Optimized loading) -->
    <script>
        // Authentication Check (Inline for security)
        (function() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn') || localStorage.getItem('adminLoggedIn');
            if (isLoggedIn !== 'true') {
                window.location.href = 'login.html';
                return;
            }

            // Display admin username
            const adminUsername = sessionStorage.getItem('adminUsername') || 'Admin';
            const adminUsernameEl = document.getElementById('adminUsername');
            if (adminUsernameEl) {
                adminUsernameEl.textContent = adminUsername.charAt(0).toUpperCase() + adminUsername.slice(1);
            }

            // Logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('mouseover', function() {
                    this.style.background = 'rgba(239, 68, 68, 0.9)';
                });
                logoutBtn.addEventListener('mouseout', function() {
                    this.style.background = 'rgba(255,255,255,0.2)';
                });
                logoutBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to logout?')) {
                        sessionStorage.removeItem('adminLoggedIn');
                        sessionStorage.removeItem('adminUsername');
                        sessionStorage.removeItem('loginTime');
                        // Don't remove localStorage items to keep "remember me" feature
                        window.location.href = 'login.html';
                    }
                });
            }

            // Session timeout (30 minutes)
            const loginTime = sessionStorage.getItem('loginTime');
            if (loginTime) {
                const currentTime = new Date().getTime();
                const loginTimestamp = new Date(loginTime).getTime();
                const thirtyMinutes = 30 * 60 * 1000;
                
                if (currentTime - loginTimestamp > thirtyMinutes) {
                    alert('Your session has expired. Please login again.');
                    sessionStorage.clear();
                    window.location.href = 'login.html';
                }
            }
        })();
    </script>
    
    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" title="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <!-- Application Scripts (Optimized: Deferred loading) -->
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- NEW CLEAN ARCHITECTURE -->
    <script defer src="data-manager.js"></script>
    <script defer src="sheets-sync.js"></script>
    <script defer src="admin-log-functions.js"></script>
    <script defer src="app.js"></script>
    <script>
        // Initialize new system
        async function initSystem() {
            if (window.DataManager && window.SheetsSync) {
                console.log('ðŸš€ Initializing clean system...');
                await window.DataManager.init();
                window.SheetsSync.start();
            } else {
                setTimeout(initSystem, 100);
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSystem);
        } else {
            initSystem();
        }
    </script>

</body>
</html>
