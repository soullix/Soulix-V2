<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Operations Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { 
            color: #667eea; 
            margin-bottom: 10px;
            font-size: 2.5em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }
        .test-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .button.success { background: #10b981; }
        .button.success:hover { background: #059669; }
        .button.danger { background: #ef4444; }
        .button.danger:hover { background: #dc2626; }
        .button.info { background: #3b82f6; }
        .button.info:hover { background: #2563eb; }
        .button.warning { background: #f59e0b; }
        .button.warning:hover { background: #d97706; }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .result.show { display: block; }
        .result.success {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
        }
        .result.error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }
        .result.info {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            color: #1e3a8a;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .table-data {
            margin-top: 15px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background: #f3f4f6;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }
        .badge.pending { background: #fef3c7; color: #92400e; }
        .badge.approved { background: #d1fae5; color: #065f46; }
        .badge.rejected { background: #fee2e2; color: #991b1b; }
        
        .log-entry {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 6px;
            font-size: 0.85em;
            border-left: 3px solid;
        }
        .log-entry.success { background: #d1fae5; border-color: #10b981; }
        .log-entry.error { background: #fee2e2; border-color: #ef4444; }
        .log-entry.info { background: #dbeafe; border-color: #3b82f6; }
        .log-entry.warning { background: #fef3c7; border-color: #f59e0b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Data Operations Test</h1>
        <p class="subtitle">Comprehensive testing for DataManager, Sheets Sync, and Database Operations</p>
        
        <!-- Connection Test -->
        <div class="test-section">
            <div class="test-title">üîå Connection & Initialization</div>
            <div class="test-description">
                Test Supabase connection, DataManager initialization, and module loading.
            </div>
            <div class="button-group">
                <button class="button info" onclick="testConnection()">
                    <span>Test Connection</span>
                </button>
                <button class="button info" onclick="testModules()">
                    <span>Check Modules</span>
                </button>
            </div>
            <div id="connectionResult" class="result"></div>
        </div>
        
        <!-- Data Loading Test -->
        <div class="test-section">
            <div class="test-title">üìä Data Loading</div>
            <div class="test-description">
                Load and display all applications from Supabase database.
            </div>
            <div class="button-group">
                <button class="button" onclick="loadAllData()">
                    <span>Load All Applications</span>
                </button>
                <button class="button" onclick="loadByStatus('Pending')">
                    <span>Load Pending</span>
                </button>
                <button class="button" onclick="loadByStatus('Approved')">
                    <span>Load Approved</span>
                </button>
                <button class="button" onclick="loadByStatus('Rejected')">
                    <span>Load Rejected</span>
                </button>
            </div>
            <div id="dataResult" class="result"></div>
            <div id="dataStats" class="stats-grid" style="display:none;"></div>
            <div id="dataTable" class="table-data"></div>
        </div>
        
        <!-- Sheets Sync Test -->
        <div class="test-section">
            <div class="test-title">üìë Google Sheets Sync</div>
            <div class="test-description">
                Test Google Sheets synchronization and new entry detection.
            </div>
            <div class="button-group">
                <button class="button success" onclick="testSheetsSync()">
                    <span>Start Sheets Sync</span>
                </button>
                <button class="button danger" onclick="stopSheetsSync()">
                    <span>Stop Sync</span>
                </button>
                <button class="button info" onclick="manualSync()">
                    <span>Manual Sync Now</span>
                </button>
            </div>
            <div id="sheetsResult" class="result"></div>
        </div>
        
        <!-- Approve/Reject Test -->
        <div class="test-section">
            <div class="test-title">‚úÖ Approve & Reject Operations</div>
            <div class="test-description">
                Test approval and rejection operations with database persistence.
            </div>
            <div class="button-group">
                <button class="button success" onclick="testApprove()">
                    <span>Test Approve</span>
                </button>
                <button class="button danger" onclick="testReject()">
                    <span>Test Reject</span>
                </button>
                <button class="button info" onclick="checkApprovedTable()">
                    <span>Check Approved Table</span>
                </button>
                <button class="button info" onclick="checkRejectedTable()">
                    <span>Check Rejected Table</span>
                </button>
            </div>
            <div id="operationResult" class="result"></div>
        </div>
        
        <!-- Admin Logs Test -->
        <div class="test-section">
            <div class="test-title">üìù Admin Logs</div>
            <div class="test-description">
                Test admin log saving and retrieval from database.
            </div>
            <div class="button-group">
                <button class="button" onclick="testSaveLog()">
                    <span>Save Test Log</span>
                </button>
                <button class="button" onclick="loadLogs(10)">
                    <span>Load Recent Logs</span>
                </button>
                <button class="button warning" onclick="loadLogs(50)">
                    <span>Load All Logs</span>
                </button>
                <button class="button danger" onclick="clearLogs()">
                    <span>Clear Display</span>
                </button>
            </div>
            <div id="logsResult" class="result"></div>
        </div>
        
        <!-- Database Direct Check -->
        <div class="test-section">
            <div class="test-title">üóÑÔ∏è Database Tables Check</div>
            <div class="test-description">
                Direct check of all Supabase tables to verify data persistence.
            </div>
            <div class="button-group">
                <button class="button info" onclick="checkAllTables()">
                    <span>Check All Tables</span>
                </button>
                <button class="button info" onclick="checkTable('applications')">
                    <span>Applications Table</span>
                </button>
                <button class="button info" onclick="checkTable('approved_applications')">
                    <span>Approved Table</span>
                </button>
                <button class="button info" onclick="checkTable('rejected_applications')">
                    <span>Rejected Table</span>
                </button>
                <button class="button info" onclick="checkTable('admin_logs')">
                    <span>Admin Logs Table</span>
                </button>
            </div>
            <div id="tableResult" class="result"></div>
        </div>
        
        <!-- Login Session Test -->
        <div class="test-section">
            <div class="test-title">üë§ Login Session Tracking</div>
            <div class="test-description">
                Test login session saving and device info tracking.
            </div>
            <div class="button-group">
                <button class="button" onclick="testLoginSession()">
                    <span>Save Login Session</span>
                </button>
                <button class="button" onclick="checkLoginSessions()">
                    <span>View All Sessions</span>
                </button>
            </div>
            <div id="sessionResult" class="result"></div>
        </div>
        
        <!-- Complete Flow Test -->
        <div class="test-section">
            <div class="test-title">üîÑ Complete Data Flow Test</div>
            <div class="test-description">
                Test the complete flow: Load ‚Üí Approve ‚Üí Reject ‚Üí Verify Persistence
            </div>
            <div class="button-group">
                <button class="button success" onclick="runCompleteTest()" style="font-size: 1.1em; padding: 15px 30px;">
                    <span>‚ñ∂Ô∏è Run Complete Test</span>
                </button>
            </div>
            <div id="completeResult" class="result"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="data-manager.js"></script>
    <script src="sheets-sync.js"></script>
    
    <script>
        let supabaseClient = null;
        let syncInterval = null;
        
        // Initialize Supabase client
        async function initSupabase() {
            if (supabaseClient) return supabaseClient;
            
            const SUPABASE_URL = 'https://xmtxeagxnqfczenqwizz.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtdHhlYWd4bnFmY3plbnF3aXp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA5NTM3MTEsImV4cCI6MjA0NjUyOTcxMX0.KnVPtLPa9LX2xMqLJGhSjl5-BfwSA6SY6W_C7y0KnS0';
            
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            return supabaseClient;
        }
        
        function showResult(elementId, type, message) {
            const el = document.getElementById(elementId);
            el.className = `result show ${type}`;
            el.innerHTML = message;
        }
        
        // Connection Test
        async function testConnection() {
            showResult('connectionResult', 'info', '‚è≥ Testing connection...');
            
            try {
                const result = await window.DataManager.init();
                
                if (result.success) {
                    showResult('connectionResult', 'success', 
                        `‚úÖ <strong>Connected Successfully!</strong><br><br>` +
                        `URL: ${result.url}<br>` +
                        `Status: Active<br>` +
                        `Timestamp: ${new Date().toLocaleString()}`
                    );
                } else {
                    showResult('connectionResult', 'error', 
                        `‚ùå <strong>Connection Failed</strong><br><br>` +
                        `Error: ${result.error}`
                    );
                }
            } catch (err) {
                showResult('connectionResult', 'error', 
                    `‚ùå <strong>Error</strong><br><br>${err.message}`
                );
            }
        }
        
        async function testModules() {
            showResult('connectionResult', 'info', '‚è≥ Checking modules...');
            
            let html = '<strong>Module Status:</strong><br><br>';
            
            // Check DataManager
            if (window.DataManager) {
                html += '‚úÖ DataManager: Loaded<br>';
                const methods = ['init', 'getAll', 'approve', 'reject', 'saveLog', 'getLogs'];
                methods.forEach(method => {
                    html += `&nbsp;&nbsp;&nbsp;‚Ä¢ ${method}(): ${typeof window.DataManager[method] === 'function' ? '‚úÖ' : '‚ùå'}<br>`;
                });
            } else {
                html += '‚ùå DataManager: Not loaded<br>';
            }
            
            html += '<br>';
            
            // Check SheetsSync
            if (window.SheetsSync) {
                html += '‚úÖ SheetsSync: Loaded<br>';
                const methods = ['start', 'stop'];
                methods.forEach(method => {
                    html += `&nbsp;&nbsp;&nbsp;‚Ä¢ ${method}(): ${typeof window.SheetsSync[method] === 'function' ? '‚úÖ' : '‚ùå'}<br>`;
                });
            } else {
                html += '‚ö†Ô∏è SheetsSync: Not loaded<br>';
            }
            
            showResult('connectionResult', 'success', html);
        }
        
        // Data Loading
        async function loadAllData() {
            showResult('dataResult', 'info', '‚è≥ Loading all applications...');
            
            try {
                const apps = window.DataManager.getAll();
                
                if (apps && apps.length > 0) {
                    const pending = apps.filter(a => a.status === 'Pending').length;
                    const approved = apps.filter(a => a.status === 'Approved').length;
                    const rejected = apps.filter(a => a.status === 'Rejected').length;
                    
                    // Show stats
                    const statsEl = document.getElementById('dataStats');
                    statsEl.style.display = 'grid';
                    statsEl.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${apps.length}</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${pending}</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${approved}</div>
                            <div class="stat-label">Approved</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${rejected}</div>
                            <div class="stat-label">Rejected</div>
                        </div>
                    `;
                    
                    // Show table
                    displayTable(apps);
                    
                    showResult('dataResult', 'success', 
                        `‚úÖ <strong>Loaded ${apps.length} applications</strong><br><br>` +
                        `Pending: ${pending} | Approved: ${approved} | Rejected: ${rejected}`
                    );
                } else {
                    showResult('dataResult', 'info', '‚ö†Ô∏è No applications found in database');
                    document.getElementById('dataStats').style.display = 'none';
                    document.getElementById('dataTable').innerHTML = '';
                }
            } catch (err) {
                showResult('dataResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        async function loadByStatus(status) {
            showResult('dataResult', 'info', `‚è≥ Loading ${status} applications...`);
            
            try {
                const apps = window.DataManager.getAll();
                const filtered = apps.filter(a => a.status === status);
                
                if (filtered.length > 0) {
                    displayTable(filtered);
                    showResult('dataResult', 'success', 
                        `‚úÖ Found ${filtered.length} ${status} applications`
                    );
                } else {
                    showResult('dataResult', 'info', 
                        `‚ö†Ô∏è No ${status} applications found`
                    );
                    document.getElementById('dataTable').innerHTML = '';
                }
            } catch (err) {
                showResult('dataResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        function displayTable(apps) {
            const tableEl = document.getElementById('dataTable');
            
            let html = '<table>';
            html += '<tr><th>ID</th><th>Name</th><th>Course</th><th>Status</th><th>Email</th><th>Phone</th></tr>';
            
            apps.forEach(app => {
                html += `
                    <tr>
                        <td>${app.id}</td>
                        <td>${app.name}</td>
                        <td>${app.course}</td>
                        <td><span class="badge ${app.status.toLowerCase()}">${app.status}</span></td>
                        <td>${app.email}</td>
                        <td>${app.phone}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            tableEl.innerHTML = html;
        }
        
        // Sheets Sync
        async function testSheetsSync() {
            showResult('sheetsResult', 'info', '‚è≥ Starting Google Sheets sync...');
            
            try {
                if (window.SheetsSync) {
                    window.SheetsSync.start();
                    showResult('sheetsResult', 'success', 
                        '‚úÖ <strong>Sheets Sync Started</strong><br><br>' +
                        'Syncing every 10 seconds...<br>' +
                        'New entries from Google Sheets will be added automatically.'
                    );
                } else {
                    showResult('sheetsResult', 'error', '‚ùå SheetsSync module not loaded');
                }
            } catch (err) {
                showResult('sheetsResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        function stopSheetsSync() {
            if (window.SheetsSync && window.SheetsSync.stop) {
                window.SheetsSync.stop();
                showResult('sheetsResult', 'info', '‚è∏Ô∏è Sheets sync stopped');
            }
        }
        
        async function manualSync() {
            showResult('sheetsResult', 'info', '‚è≥ Manually syncing now...');
            
            // Trigger a sync manually
            if (window.SheetsSync && window.SheetsSync.syncNow) {
                const result = await window.SheetsSync.syncNow();
                showResult('sheetsResult', 'success', `‚úÖ Sync complete: ${result.message}`);
            } else {
                showResult('sheetsResult', 'info', 'Manual sync not available. Use Start Sync button.');
            }
        }
        
        // Approve/Reject Tests
        async function testApprove() {
            showResult('operationResult', 'info', '‚è≥ Testing approval...');
            
            try {
                const apps = window.DataManager.getAll();
                const pending = apps.find(a => a.status === 'Pending');
                
                if (!pending) {
                    showResult('operationResult', 'info', '‚ö†Ô∏è No pending applications to approve');
                    return;
                }
                
                const payment = {
                    amount: '5000',
                    type: 'Test Payment',
                    status: 'Paid',
                    transactionId: 'TEST' + Date.now()
                };
                
                const result = await window.DataManager.approve(pending.id, payment);
                
                if (result.success) {
                    showResult('operationResult', 'success', 
                        `‚úÖ <strong>Application Approved!</strong><br><br>` +
                        `Student: ${pending.name}<br>` +
                        `Course: ${pending.course}<br>` +
                        `Payment: ‚Çπ${payment.amount}<br><br>` +
                        `‚úÖ Saved to applications table<br>` +
                        `‚úÖ Saved to approved_applications table<br>` +
                        `‚úÖ Payment recorded in payments table`
                    );
                } else {
                    showResult('operationResult', 'error', `‚ùå Approval failed: ${result.error}`);
                }
            } catch (err) {
                showResult('operationResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        async function testReject() {
            showResult('operationResult', 'info', '‚è≥ Testing rejection...');
            
            try {
                const apps = window.DataManager.getAll();
                const pending = apps.find(a => a.status === 'Pending');
                
                if (!pending) {
                    showResult('operationResult', 'info', '‚ö†Ô∏è No pending applications to reject');
                    return;
                }
                
                const reason = 'Test rejection - Insufficient documents';
                const result = await window.DataManager.reject(pending.id, reason);
                
                if (result.success) {
                    showResult('operationResult', 'success', 
                        `‚úÖ <strong>Application Rejected!</strong><br><br>` +
                        `Student: ${pending.name}<br>` +
                        `Course: ${pending.course}<br>` +
                        `Reason: ${reason}<br><br>` +
                        `‚úÖ Saved to applications table<br>` +
                        `‚úÖ Saved to rejected_applications table`
                    );
                } else {
                    showResult('operationResult', 'error', `‚ùå Rejection failed: ${result.error}`);
                }
            } catch (err) {
                showResult('operationResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        async function checkApprovedTable() {
            showResult('operationResult', 'info', '‚è≥ Checking approved_applications table...');
            
            try {
                if (!supabaseClient) await initSupabase();
                
                const { data, error } = await supabaseClient
                    .from('approved_applications')
                    .select('*')
                    .order('approved_date', { ascending: false });
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    let html = `‚úÖ <strong>Found ${data.length} approved applications</strong><br><br>`;
                    data.slice(0, 5).forEach(app => {
                        html += `‚Ä¢ ${app.student_name} (${app.course}) - ${new Date(app.approved_date).toLocaleDateString()}<br>`;
                    });
                    showResult('operationResult', 'success', html);
                } else {
                    showResult('operationResult', 'info', '‚ö†Ô∏è No approved applications in database');
                }
            } catch (err) {
                showResult('operationResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        async function checkRejectedTable() {
            showResult('operationResult', 'info', '‚è≥ Checking rejected_applications table...');
            
            try {
                if (!supabaseClient) await initSupabase();
                
                const { data, error } = await supabaseClient
                    .from('rejected_applications')
                    .select('*')
                    .order('rejected_date', { ascending: false });
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    let html = `‚úÖ <strong>Found ${data.length} rejected applications</strong><br><br>`;
                    data.slice(0, 5).forEach(app => {
                        html += `‚Ä¢ ${app.student_name} (${app.course})<br>&nbsp;&nbsp;Reason: ${app.rejection_reason}<br>`;
                    });
                    showResult('operationResult', 'success', html);
                } else {
                    showResult('operationResult', 'info', '‚ö†Ô∏è No rejected applications in database yet');
                }
            } catch (err) {
                showResult('operationResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        // Admin Logs
        async function testSaveLog() {
            showResult('logsResult', 'info', '‚è≥ Saving test log...');
            
            try {
                const result = await window.DataManager.saveLog(
                    'info',
                    'Test Log Entry',
                    `Test log created at ${new Date().toLocaleString()}`
                );
                
                if (result.success) {
                    showResult('logsResult', 'success', 
                        '‚úÖ <strong>Log saved successfully!</strong><br><br>' +
                        'Check admin_logs table in Supabase to verify.'
                    );
                } else {
                    showResult('logsResult', 'error', `‚ùå Failed to save log: ${result.error}`);
                }
            } catch (err) {
                showResult('logsResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        async function loadLogs(limit = 10) {
            showResult('logsResult', 'info', `‚è≥ Loading ${limit} recent logs...`);
            
            try {
                const logs = await window.DataManager.getLogs(limit);
                
                if (logs && logs.length > 0) {
                    let html = `‚úÖ <strong>Found ${logs.length} logs</strong><br><br>`;
                    logs.forEach(log => {
                        html += `<div class="log-entry ${log.log_type}">`;
                        html += `<strong>${log.title}</strong><br>`;
                        html += `${log.message}<br>`;
                        html += `<small>${new Date(log.created_at).toLocaleString()}</small>`;
                        html += `</div>`;
                    });
                    showResult('logsResult', 'success', html);
                } else {
                    showResult('logsResult', 'info', '‚ö†Ô∏è No logs found');
                }
            } catch (err) {
                showResult('logsResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        function clearLogs() {
            document.getElementById('logsResult').className = 'result';
        }
        
        // Database Tables Check
        async function checkAllTables() {
            showResult('tableResult', 'info', '‚è≥ Checking all tables...');
            
            try {
                if (!supabaseClient) await initSupabase();
                
                const tables = [
                    'applications',
                    'approved_applications',
                    'rejected_applications',
                    'admin_logs',
                    'payments',
                    'login_sessions'
                ];
                
                let html = '<strong>Database Table Status:</strong><br><br>';
                
                for (const table of tables) {
                    const { data, error } = await supabaseClient.from(table).select('*', { count: 'exact', head: true });
                    
                    if (error) {
                        html += `‚ùå ${table}: Error - ${error.message}<br>`;
                    } else {
                        const count = data?.length || 0;
                        html += `‚úÖ ${table}: ${count} rows<br>`;
                    }
                }
                
                showResult('tableResult', 'success', html);
            } catch (err) {
                showResult('tableResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        async function checkTable(tableName) {
            showResult('tableResult', 'info', `‚è≥ Checking ${tableName} table...`);
            
            try {
                if (!supabaseClient) await initSupabase();
                
                const { data, error, count } = await supabaseClient
                    .from(tableName)
                    .select('*', { count: 'exact' })
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    let html = `‚úÖ <strong>${tableName}: ${data.length} rows (showing recent 10)</strong><br><br>`;
                    html += '<pre style="max-height: 400px; overflow-y: auto;">';
                    html += JSON.stringify(data, null, 2);
                    html += '</pre>';
                    showResult('tableResult', 'success', html);
                } else {
                    showResult('tableResult', 'info', `‚ö†Ô∏è ${tableName} is empty`);
                }
            } catch (err) {
                showResult('tableResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        // Login Session
        async function testLoginSession() {
            showResult('sessionResult', 'info', '‚è≥ Saving login session...');
            
            try {
                await window.DataManager.saveLoginSession();
                showResult('sessionResult', 'success', 
                    '‚úÖ <strong>Login session saved!</strong><br><br>' +
                    'Session tracked with device and browser info.'
                );
            } catch (err) {
                showResult('sessionResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        async function checkLoginSessions() {
            showResult('sessionResult', 'info', '‚è≥ Loading login sessions...');
            
            try {
                if (!supabaseClient) await initSupabase();
                
                const { data, error } = await supabaseClient
                    .from('login_sessions')
                    .select('*')
                    .order('login_time', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    let html = `‚úÖ <strong>Found ${data.length} recent sessions</strong><br><br>`;
                    data.forEach(session => {
                        html += `‚Ä¢ ${session.username || 'Admin'} - ${new Date(session.login_time).toLocaleString()}<br>`;
                        html += `&nbsp;&nbsp;${session.device_type} | ${session.browser}<br>`;
                    });
                    showResult('sessionResult', 'success', html);
                } else {
                    showResult('sessionResult', 'info', '‚ö†Ô∏è No login sessions found');
                }
            } catch (err) {
                showResult('sessionResult', 'error', `‚ùå Error: ${err.message}`);
            }
        }
        
        // Complete Flow Test
        async function runCompleteTest() {
            const resultEl = document.getElementById('completeResult');
            resultEl.className = 'result show info';
            
            let html = '<strong>üîÑ Running Complete Data Flow Test...</strong><br><br>';
            resultEl.innerHTML = html;
            
            try {
                // Step 1: Initialize
                html += '1Ô∏è‚É£ Initializing DataManager...<br>';
                resultEl.innerHTML = html;
                await new Promise(r => setTimeout(r, 500));
                
                const initResult = await window.DataManager.init();
                if (!initResult.success) throw new Error('Initialization failed');
                html += '&nbsp;&nbsp;‚úÖ Connected to Supabase<br><br>';
                resultEl.innerHTML = html;
                
                // Step 2: Load data
                html += '2Ô∏è‚É£ Loading applications...<br>';
                resultEl.innerHTML = html;
                await new Promise(r => setTimeout(r, 500));
                
                const apps = window.DataManager.getAll();
                html += `&nbsp;&nbsp;‚úÖ Loaded ${apps.length} applications<br><br>`;
                resultEl.innerHTML = html;
                
                // Step 3: Check tables
                html += '3Ô∏è‚É£ Checking database tables...<br>';
                resultEl.innerHTML = html;
                await new Promise(r => setTimeout(r, 500));
                
                if (!supabaseClient) await initSupabase();
                
                const tables = ['approved_applications', 'rejected_applications', 'admin_logs'];
                for (const table of tables) {
                    const { data } = await supabaseClient.from(table).select('*', { count: 'exact' });
                    html += `&nbsp;&nbsp;‚úÖ ${table}: ${data?.length || 0} rows<br>`;
                    resultEl.innerHTML = html;
                }
                html += '<br>';
                resultEl.innerHTML = html;
                
                // Step 4: Test log saving
                html += '4Ô∏è‚É£ Testing log persistence...<br>';
                resultEl.innerHTML = html;
                await new Promise(r => setTimeout(r, 500));
                
                await window.DataManager.saveLog('info', 'Complete Test', 'Testing data flow');
                html += '&nbsp;&nbsp;‚úÖ Log saved to database<br><br>';
                resultEl.innerHTML = html;
                
                // Step 5: Summary
                html += '<br><strong>‚úÖ Complete Test Finished Successfully!</strong><br><br>';
                html += '<strong>Summary:</strong><br>';
                html += `‚Ä¢ DataManager: Working ‚úÖ<br>`;
                html += `‚Ä¢ Data Loading: Working ‚úÖ<br>`;
                html += `‚Ä¢ Database Tables: Accessible ‚úÖ<br>`;
                html += `‚Ä¢ Log Persistence: Working ‚úÖ<br>`;
                html += `<br><strong>Your system is ready to use!</strong>`;
                
                resultEl.className = 'result show success';
                resultEl.innerHTML = html;
                
            } catch (err) {
                html += `<br><br>‚ùå <strong>Test Failed:</strong> ${err.message}`;
                resultEl.className = 'result show error';
                resultEl.innerHTML = html;
            }
        }
        
        // Auto-initialize on load
        window.addEventListener('load', async () => {
            console.log('üß™ Data Check page loaded');
            if (window.DataManager) {
                await window.DataManager.init();
            }
        });
    </script>
</body>
</html>
